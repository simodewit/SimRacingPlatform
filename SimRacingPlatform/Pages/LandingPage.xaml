<Page
    x:Class="SimRacingPlatform.Pages.LandingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:SimRacingPlatform.Pages"
    mc:Ignorable="d"
    x:Name="RootPage">

    <Page.Resources>

        <!-- Slight padding so content feels tight but not cramped -->
        <Thickness x:Key="CardPadding">8</Thickness>
        <CornerRadius x:Key="CardCornerRadius">10</CornerRadius>
        <Thickness x:Key="CardBorderThickness">1</Thickness>

        <SolidColorBrush x:Key="DividerBrush" Color="#26000000"/>

        <!-- Patch notes: align container hover with visual card -->
        <Style x:Key="PatchNoteItemContainerStyle" TargetType="ListViewItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Margin" Value="0,3"/>
        </Style>

        <!-- ========== PATCH NOTES TEMPLATE (RIGHT PANEL) ========== -->

        <DataTemplate x:Key="PatchNoteTemplateCompact" x:DataType="local:PatchNote">
            <Border Padding="8"
                    CornerRadius="8"
                    BorderThickness="1"
                    BorderBrush="{StaticResource DividerBrush}"
                    Background="{ThemeResource CardBackgroundFillColorSecondary}">
                <StackPanel Spacing="3">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="{x:Bind Version}" FontWeight="SemiBold"/>
                        <TextBlock Text="{x:Bind Date}"
                                   FontSize="11"
                                   Foreground="{ThemeResource TextFillColorSecondary}"/>
                        <Border Background="{ThemeResource AccentFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="5,0">
                            <TextBlock Text="{x:Bind Tag}"
                                       FontSize="10"
                                       Foreground="White"/>
                        </Border>
                    </StackPanel>

                    <TextBlock Text="{x:Bind ShortTitle}"
                               FontSize="12"
                               FontWeight="SemiBold"
                               TextWrapping="WrapWholeWords"/>

                    <TextBlock Text="{x:Bind Summary}"
                               FontSize="11"
                               TextWrapping="Wrap"
                               TextTrimming="WordEllipsis"
                               MaxLines="4"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- ========== ANNOUNCEMENT TEMPLATE (TOP LEFT) ========== -->
        <!-- Height capped so the panel doesn’t grow too tall -->
        <DataTemplate x:Key="AnnouncementTemplate" x:DataType="local:Announcement">
            <Border CornerRadius="10"
                    BorderThickness="1"
                    BorderBrush="{StaticResource DividerBrush}"
                    Background="{ThemeResource CardBackgroundFillColorSecondary}"
                    MaxHeight="260">
                <Grid>
                    <Image Source="{x:Bind ImagePath}"
                           Stretch="UniformToFill"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Stretch"
                           Opacity="0.95"/>

                    <!-- Overlay bar with text AND nav buttons -->
                    <Border Background="#7A000000"
                            VerticalAlignment="Bottom"
                            CornerRadius="0,0,10,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Text on the left -->
                            <StackPanel Grid.Column="0"
                                        Padding="10"
                                        Spacing="3">
                                <TextBlock Text="{x:Bind Title}"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="White"
                                           TextWrapping="WrapWholeWords"/>
                                <TextBlock Text="{x:Bind Description}"
                                           FontSize="13"
                                           Foreground="White"
                                           Opacity="0.9"
                                           TextWrapping="Wrap"
                                           MaxLines="3"
                                           TextTrimming="WordEllipsis"/>
                            </StackPanel>

                            <!-- Position + buttons on the right, inside the same bar -->
                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Bottom"
                                        Padding="6,4"
                                        Spacing="4">
                                <!-- Binding to the page property (NOT x:Bind) so we can use ElementName -->
                                <TextBlock Text="{Binding ElementName=RootPage, Path=AnnouncementPositionText}"
                                           FontSize="11"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Margin="0,0,4,0"/>
                                <Button Content="◀"
                                        Width="28"
                                        Height="28"
                                        Click="PreviousAnnouncement_Click"/>
                                <Button Content="▶"
                                        Width="28"
                                        Height="28"
                                        Click="NextAnnouncement_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- ========== NEWS ARTICLE TEMPLATE (SMALL TILES) ========== -->
        <!-- Small clickable images with bottom bar; sized to allow ~5 per row -->
        <DataTemplate x:Key="NewsArticleTemplate" x:DataType="local:NewsArticle">
            <Button
                Padding="0"
                Margin="4"
                HorizontalContentAlignment="Stretch"
                Background="Transparent"
                BorderThickness="0"
                Click="NewsArticle_Click">
                <Border CornerRadius="10"
                        BorderThickness="1"
                        BorderBrush="{StaticResource DividerBrush}"
                        Background="{ThemeResource CardBackgroundFillColorSecondary}"
                        Width="140"
                        Height="100">
                    <Grid>
                        <Image Source="{x:Bind ThumbnailPath}"
                               Stretch="UniformToFill"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Stretch"/>

                        <!-- Greyed bar at the bottom like the announcements -->
                        <Border Background="#7A000000"
                                VerticalAlignment="Bottom"
                                CornerRadius="0,0,10,10">
                            <StackPanel Orientation="Vertical"
                                        Padding="6"
                                        Spacing="2">
                                <TextBlock Text="{x:Bind Title}"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="White"
                                           TextWrapping="WrapWholeWords"
                                           MaxLines="2"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{x:Bind Category}"
                                           FontSize="10"
                                           Foreground="White"
                                           Opacity="0.85"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Button>
        </DataTemplate>

    </Page.Resources>

    <Grid Padding="16" RowSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Overlay button -->
            <RowDefinition Height="Auto"/>
            <!-- Welcome -->
            <RowDefinition Height="*"/>
            <!-- Main content -->
        </Grid.RowDefinitions>

        <!-- Top full-width "Open overlay" button (disabled for now) -->
        <Button Grid.Row="0"
                Content="Open overlay"
                HorizontalAlignment="Stretch"
                Margin="0,0,0,12"
                IsEnabled="False"
                Height="40"/>

        <!-- Welcome message -->
        <TextBlock Grid.Row="1"
                   Text="Welcome to Your App!"
                   FontSize="24"
                   FontWeight="SemiBold"
                   Margin="0,0,0,16"/>

        <!-- MAIN CONTENT: whole thing scrolls vertically -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <!-- Left: announcements + news -->
                    <ColumnDefinition Width="320"/>
                    <!-- Right: patch notes -->
                </Grid.ColumnDefinitions>

                <!-- LEFT: Announcements + News -->
                <Grid Grid.Column="0"
                      Margin="0,0,16,0"
                      RowSpacing="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- announcement panel -->
                        <RowDefinition Height="Auto"/>
                        <!-- news grid -->
                    </Grid.RowDefinitions>

                    <!-- Announcements Card (height limited via template) -->
                    <Border Grid.Row="0"
                            Padding="{StaticResource CardPadding}"
                            CornerRadius="{StaticResource CardCornerRadius}"
                            BorderThickness="{StaticResource CardBorderThickness}"
                            BorderBrush="{StaticResource DividerBrush}"
                            Background="{ThemeResource CardBackgroundFillColorDefault}">
                        <ContentControl Content="{x:Bind SelectedAnnouncement, Mode=OneWay}"
                                        ContentTemplate="{StaticResource AnnouncementTemplate}"/>
                    </Border>

                    <!-- News Card (no internal scroll; page scrolls instead) -->
                    <Border Grid.Row="1"
                            Margin="0,12,0,0"
                            Padding="{StaticResource CardPadding}"
                            CornerRadius="{StaticResource CardCornerRadius}"
                            BorderThickness="{StaticResource CardBorderThickness}"
                            BorderBrush="{StaticResource DividerBrush}"
                            Background="{ThemeResource CardBackgroundFillColorDefault}">
                        <ItemsControl ItemsSource="{x:Bind NewsArticles}"
                                      ItemTemplate="{StaticResource NewsArticleTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <!-- Wrap items so we get multiple per row -->
                                    <WrapGrid Orientation="Horizontal"
                                              ItemWidth="140"
                                              ItemHeight="100"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </Border>
                </Grid>

                <!-- RIGHT: Patch Notes Card -->
                <Border Grid.Column="1"
                        Padding="{StaticResource CardPadding}"
                        CornerRadius="{StaticResource CardCornerRadius}"
                        BorderThickness="{StaticResource CardBorderThickness}"
                        BorderBrush="{StaticResource DividerBrush}"
                        Background="{ThemeResource CardBackgroundFillColorDefault}">
                    <ListView x:Name="PatchNotesListView"
                              ItemsSource="{x:Bind PatchNotes}"
                              ItemTemplate="{StaticResource PatchNoteTemplateCompact}"
                              ItemContainerStyle="{StaticResource PatchNoteItemContainerStyle}"
                              IsItemClickEnabled="True"
                              SelectionMode="None"
                              VerticalAlignment="Stretch"
                              HorizontalAlignment="Stretch"
                              Margin="0,2,0,0"
                              ItemClick="PatchNotesListView_ItemClick"/>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
